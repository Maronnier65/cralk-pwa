<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CRALK</title>
    <!-- Link to the PWA manifest for installation on iOS/Android -->
    <link rel="manifest" href="manifest.json" />
    <!-- Fallback icon for older browsers -->
    <link rel="icon" type="image/png" href="icon-192.png" />
    <!-- Apple specific tags for iOS PWA support -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="CRALK" />
    <link rel="apple-touch-icon" href="icon-512.png" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Splash screen displayed briefly on app launch -->
    <div id="splash-screen" class="splash-screen">
      <img src="icon-512.png" alt="CRALK logo" class="splash-logo" />
      <h1 class="splash-title">CRALK</h1>
    </div>
    <main id="app-container">
      <!-- Screen container manages slide transitions between recording and gallery screens -->
      <div id="screen-container">
        <!-- Recorder screen: displays the camera and controls -->
        <div class="screen recorder-screen">
          <video id="camera-preview" autoplay playsinline muted></video>
          <!-- Overlay contains both top and bottom control bars -->
          <div class="overlay">
            <!-- Top bar: choose song, display name and timer -->
            <div class="top-bar">
              <!-- Music selector: clicking the icon opens the hidden file input -->
              <label id="choose-song-btn" class="top-button" for="file-input" title="Choisir une chanson">
                <svg class="icon music-icon" viewBox="0 0 24 24" width="24" height="24">
                  <!-- simple quaver icon: two circles and a stem -->
                  <circle cx="9" cy="16" r="3" fill="currentColor" />
                  <circle cx="15" cy="18" r="3" fill="currentColor" />
                  <rect x="14" y="4" width="2" height="14" fill="currentColor" />
                  <rect x="16" y="4" width="2" height="6" fill="currentColor" />
                </svg>
              </label>
              <input
                id="file-input"
                type="file"
                accept="audio/*"
                aria-label="Sélectionnez un fichier audio"
                hidden
              />
              <!-- Selected file name -->
              <span id="file-info" class="file-info"></span>
              <!-- Single timer showing total duration or remaining time -->
              <span id="song-timer" class="song-timer"></span>
            </div>
            <!-- Bottom controls: camera switch, record, audio toggle -->
            <div class="bottom-controls">
              <!-- Camera switch button -->
              <button id="switch-camera" class="icon-button" title="Changer de caméra">
                <svg class="icon camera-icon" viewBox="0 0 24 24" width="24" height="24">
                  <!-- simple camera icon: body and lens -->
                  <rect x="3" y="6" width="18" height="12" rx="3" ry="3" fill="none" stroke="currentColor" stroke-width="2" />
                  <circle cx="12" cy="12" r="4" fill="none" stroke="currentColor" stroke-width="2" />
                  <rect x="6" y="4" width="5" height="3" fill="currentColor" />
                </svg>
              </button>
              <!-- Record button: red dot in centre of a circular button -->
              <button id="record-button" class="record-button" disabled>
                <span class="record-icon"></span>
              </button>
              <!-- Toggle audio source button: contains both mic and note icons; JS toggles visibility -->
              <button id="toggle-source" class="icon-button" title="Source audio" disabled>
                <svg class="icon mic-icon" viewBox="0 0 24 24" width="24" height="24">
                  <!-- Enhanced microphone icon: larger capsule head and clear stand for recognisable shape -->
                  <path d="M12 16c2.21 0 4-1.79 4-4V8a4 4 0 00-8 0v4c0 2.21 1.79 4 4 4z" fill="currentColor" />
                  <path d="M20 11h-2c0 4.42-3.58 8-8 8s-8-3.58-8-8H4c0 5.25 4.09 9.6 9 9.96V23h2v-2.04C15.91 20.6 20 16.25 20 11z" fill="currentColor" />
                </svg>
                <svg class="icon note-toggle-icon" viewBox="0 0 24 24" width="24" height="24" style="display:none;">
                  <!-- reuse the quaver icon for the toggle state -->
                  <circle cx="9" cy="16" r="3" fill="currentColor" />
                  <circle cx="15" cy="18" r="3" fill="currentColor" />
                  <rect x="14" y="4" width="2" height="14" fill="currentColor" />
                  <rect x="16" y="4" width="2" height="6" fill="currentColor" />
                </svg>
              </button>
            </div>
          </div>
          <!-- Countdown overlay before song starts -->
          <div id="countdown-overlay" class="countdown-overlay"></div>
          <!-- Hidden audio element used for playback -->
          <audio id="audio-player"></audio>
        </div>
        <!-- Gallery screen: lists recorded videos -->
        <div class="screen gallery-screen">
          <!-- Controls at the top of the gallery for mass actions -->
          <div class="gallery-controls">
            <button id="delete-all" class="icon-button" title="Effacer toutes les vidéos">
              <svg class="icon trash-icon" viewBox="0 0 24 24" width="24" height="24">
                <!-- simple trash can: lid and body -->
                <rect x="5" y="9" width="14" height="12" rx="2" ry="2" fill="currentColor" />
                <rect x="7" y="4" width="10" height="3" fill="currentColor" />
                <rect x="4" y="7" width="16" height="2" fill="currentColor" />
              </svg>
            </button>
            <button id="download-all" class="icon-button" title="Télécharger toutes les vidéos et effacer">
              <svg class="icon download-icon" viewBox="0 0 24 24" width="24" height="24">
                <!-- simple arrow down inside a box -->
                <path d="M12 3v10" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                <path d="M8 11l4 4 4-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <rect x="4" y="17" width="16" height="2" fill="currentColor" />
              </svg>
            </button>
            <button id="help-btn" class="icon-button" title="Aide">
              <svg class="icon help-icon" viewBox="0 0 24 24" width="24" height="24">
                <!-- circle with a question mark -->
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" />
                <path d="M12 8a2.5 2.5 0 1 1 0 5v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" />
                <circle cx="12" cy="17" r="1.5" fill="currentColor" />
              </svg>
            </button>
          </div>
          <div id="gallery-recordings"></div>
        </div>
      </div>
    </main>
    <script src="main.js"></script>
  </body>
</html>